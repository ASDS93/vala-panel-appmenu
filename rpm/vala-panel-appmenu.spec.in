Name: @CMAKE_PROJECT_NAME@
Version: @CPACK_PACKAGE_VERSION@
Release: @CPACK_PACKAGE_RELEASE@%{?dist}
Group: User Interface/Desktops
%if %{defined suse_version}
License: LGPL-3.0+
%else
License: LGPLv3.0+
%endif
URL: https://github.com/rilian-la-te/@CMAKE_PROJECT_NAME@
Source: @CPACK_SOURCE_PACKAGE_FILE_NAME@.tar.gz
Summary: This package provides Application Menu plugin for vala-panel
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
BuildRequires: cmake >= 2.8.0
BuildRequires: gettext
BuildRequires: vala >= 0.24.0
BuildRequires: gtk3-devel >= 3.12.0
BuildRequires: libpeas-devel >= 1.2.0
BuildRequires: bamf-devel >= 0.2.111
BuildRequires: xfce4-panel-devel >= 4.11.0
BuildRequires: xfconf-devel
BuildRequires: vala-panel-devel
%if %{defined suse_version}
BuildRequires: libwnck-devel >= 3.4.0
%else
BuildRequires: libwnck3-devel >= 3.4.0
%endif
Requires: bamf-daemon

%description
This is Application Menu (Global Menu) plugin.
It built using Unity protocol and libraries,
and share all Unity limitations and advancements.

%prep
%setup -q 

%build
cmake . -DGSETTINGS_COMPILE=OFF -DCMAKE_INSTALL_PREFIX=%{_prefix} -DCMAKE_INSTALL_INCLUDEDIR=%{_includedir} -DCMAKE_INSTALL_LIBDIR=%{_libdir} -DCMAKE_INSTALL_SYSCONFDIR=%{_sysconfdir} -DCMAKE_INSTALL_DATAROOTDIR=%{_datarootdir} -DCMAKE_INSTALL_DATADIR=%{_datadir}
make %{?_smp_mflags}

%install 
make install DESTDIR=%{buildroot}
%find_lang %{name}

%clean
rm -rf %{buildroot}


%postun
set -o monitor
if [ $1 -eq 0 ] ; then
    /usr/bin/glib-compile-schemas %{_datadir}/glib-2.0/schemas &> /dev/null || :
fi

%posttrans
set -o monitor
/usr/bin/glib-compile-schemas %{_datadir}/glib-2.0/schemas &> /dev/null || :

%files
%defattr(644,root,root,755)
%doc README.md
%{_datadir}/glib-2.0/schemas/org.valapanel.appmenu.gschema.xml
%dir %{_libdir}/vala-panel
%dir %{_libdir}/vala-panel/applets
%{_libdir}/vala-panel/applets/libappmenu-valapanel.so
%{_libdir}/vala-panel/applets/appmenu.plugin

%package lang
Group: User Interface/Desktops
Summary: Translations for @CMAKE_PROJECT_NAME@
BuildArch: noarch
Requires: @CMAKE_PROJECT_NAME@ = @CPACK_PACKAGE_VERSION@
%description lang
This is a translation files for @CMAKE_PROJECT_NAME@ package.
%files lang -f %{name}.lang
%defattr(644,root,root,755)

%package -n xfce4-vala-appmenu-plugin
Group: User Interface/Desktops
Summary: This package provides Application Menu plugin for xfce4-panel
Requires: bamf-daemon
%description -n xfce4-vala-appmenu-plugin
This is Application Menu (Global Menu) plugin.
It built using Unity protocol and libraries,
and share all Unity limitations and advancements.
%files -n xfce4-vala-appmenu-plugin
%defattr(644,root,root,755)
%dir %{_libdir}/xfce4
%dir %{_libdir}/xfce4/plugins
%dir %{_datadir}/xfce4
%dir %{_datadir}/xfce4/plugins
%{_libdir}/xfce4/plugins/libappmenu-xfce.so
%{_datadir}/xfce4/plugins/appmenu.desktop

%changelog
* Mon Apr 27 2015 Konstantin <ria.freelander@gmail.com> - @CPACK_PACKAGE_VERSION@
  Generated by CMake UseRPMTools macros
